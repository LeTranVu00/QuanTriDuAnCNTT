<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qu·∫£n tr·ªã kh√≥a h·ªçc</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-color: #f5f7fa;
      font-family: 'Inter', sans-serif;
    }
    .admin-container {
      max-width: 800px;
      margin: 60px auto;
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .admin-container h1 {
      font-size: 1.8rem;
      color: #003366;
      margin-bottom: 24px;
    }
    .course-item {
      border-bottom: 1px solid #ddd;
      padding: 12px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .course-item h3 {
      margin: 0;
      color: #007acc;
    }
    .delete-btn, .edit-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 8px;
    }
    .delete-btn:hover {
      background-color: #b02a37;
    }
    .edit-btn {
      background-color: #ffc107;
      color: #333;
    }
    .edit-btn:hover {
      background-color: #e0a800;
    }
    .add-form {
      margin-bottom: 24px;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 16px;
    }
    .add-form input {
      margin: 6px 0;
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .add-form button {
      margin-top: 10px;
      background-color: #007acc;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .add-form button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
<div class="admin-container">
  <h1>üîß Qu·∫£n l√Ω kh√≥a h·ªçc</h1>

  <div class="add-form">
    <h3 id="form-title">‚ûï Th√™m kh√≥a h·ªçc m·ªõi</h3>
    <input type="text" id="title" placeholder="Ti√™u ƒë·ªÅ kh√≥a h·ªçc" />
    <input type="text" id="desc" placeholder="M√¥ t·∫£ kh√≥a h·ªçc" />
    <input type="text" id="image" placeholder="Link h√¨nh ·∫£nh" />
    <input type="text" id="date" placeholder="Ng√†y ƒëƒÉng" />
    <input type="text" id="category" placeholder="Danh m·ª•c" />
    <input type="text" id="content" placeholder="N·ªôi dung (c√°ch nhau b·∫±ng d·∫•u |)" />
    <button id="submit-btn" onclick="submitCourse()">Th√™m kh√≥a h·ªçc</button>
  </div>

  <div id="admin-course-list"></div>
  <a href="index.html" class="back-link">‚Üê Quay l·∫°i trang ch·ªß</a>
</div>

<script>
  if (localStorage.getItem('role') !== 'admin') {
    alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p!');
    window.location.href = 'index.html';
  }

  let userCourses = JSON.parse(localStorage.getItem('userCourses') || '[]');
  const myCourses = JSON.parse(localStorage.getItem('myCourses') || '[]');
  const adminList = document.getElementById('admin-course-list');

  let isEditing = false;
  let editingIndex = null;

  function renderAdminCourses() {
    adminList.innerHTML = '';

    if (userCourses.length === 0) {
      adminList.innerHTML = '<p style="color:#888">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o.</p>';
      return;
    }

    userCourses.forEach((course, index) => {
      const buyCount = myCourses.filter(c => c.id === course.id).length;

      const div = document.createElement('div');
      div.className = 'course-item';
      div.innerHTML = `
        <div>
          <h3>${course.title}</h3>
          <p>${course.desc}</p>
          <p><strong>Ng√†y ƒëƒÉng:</strong> ${course.date}</p>
          <p><strong>Chuy√™n m·ª•c:</strong> ${course.category}</p>
          <p><strong>L∆∞·ª£t mua:</strong> ${buyCount}</p>
        </div>
        <div>
          <button class="edit-btn" onclick="editCourse(${index})">S·ª≠a</button>
          <button class="delete-btn" onclick="deleteCourse(${index})">X√≥a</button>
        </div>
      `;
      adminList.appendChild(div);
    });
  }

  function submitCourse() {
    const title = document.getElementById('title').value.trim();
    const desc = document.getElementById('desc').value.trim();
    const image = document.getElementById('image').value.trim();
    const date = document.getElementById('date').value.trim();
    const category = document.getElementById('category').value.trim();
    const content = document.getElementById('content').value.trim().split('|');

    if (!title || !desc || !image || !date || !category || content.length === 0) {
      alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß!');
      return;
    }

    if (isEditing) {
      userCourses[editingIndex] = {
        ...userCourses[editingIndex],
        title, desc, image, date, category, content
      };
      alert('C·∫≠p nh·∫≠t th√†nh c√¥ng!');
    } else {
      const newCourse = {
        id: Date.now().toString(),
        title, desc, image, date, category, content
      };
      userCourses.push(newCourse);
      alert('ƒê√£ th√™m kh√≥a h·ªçc!');
    }

    localStorage.setItem('userCourses', JSON.stringify(userCourses));
    resetForm();
    renderAdminCourses();
  }

  function deleteCourse(index) {
    if (confirm('X√°c nh·∫≠n x√≥a?')) {
      userCourses.splice(index, 1);
      localStorage.setItem('userCourses', JSON.stringify(userCourses));
      renderAdminCourses();
    }
  }

  function editCourse(index) {
    const c = userCourses[index];
    document.getElementById('title').value = c.title;
    document.getElementById('desc').value = c.desc;
    document.getElementById('image').value = c.image;
    document.getElementById('date').value = c.date;
    document.getElementById('category').value = c.category;
    document.getElementById('content').value = (c.content || []).join('|');

    document.getElementById('form-title').textContent = '‚úèÔ∏è Ch·ªânh s·ª≠a kh√≥a h·ªçc';
    document.getElementById('submit-btn').textContent = 'C·∫≠p nh·∫≠t';
    isEditing = true;
    editingIndex = index;
  }

  function resetForm() {
    document.querySelectorAll('.add-form input').forEach(input => input.value = '');
    document.getElementById('submit-btn').textContent = 'Th√™m kh√≥a h·ªçc';
    document.getElementById('form-title').textContent = '‚ûï Th√™m kh√≥a h·ªçc m·ªõi';
    isEditing = false;
    editingIndex = null;
  }

  renderAdminCourses();
</script>
</body>
</html>
